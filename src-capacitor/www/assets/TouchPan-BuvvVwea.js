import{af as T,bx as q,K as D,ag as N,L as x,by as P,ai as B,aj as M,bz as z,bA as A,bB as F,bC as I,aC as X,aD as w,at as U,aE as G,aF as g,aG as b,bD as O,bE as y,aH as E,aK as V,aI as $,aJ as Y}from"./index-CHdFPrnc.js";function c(s){const{editorView:i,template:o}=s,u=s.focusOffset||0,e=i.state.doc.lineAt(i.state.selection.main.head),t=i.state.selection.main.head,d=s.overrideLine?e.from:t,r=s.overrideLine?e.to:t;i.dispatch({changes:{from:d,to:r,insert:o}});const a=d+(u||o.length);i.dispatch({selection:{anchor:a,head:a}}),setTimeout(()=>i.focus())}const l="editor",Q=()=>{const s=T(),i=q(),o=D(),u=N(),e=x(),t=P(),d=[{command:"undo",icon:"undo",description:"undo",group:l,handler:()=>z(o.editorView)},{command:"redo",icon:"redo",description:"redo",group:l,handler:()=>A(o.editorView)},{command:"tab",icon:"keyboard_tab",description:"tab",group:l,handler:()=>t.notify("not implemented yet")},{command:"headline 1",icon:"view_headline",description:"insert a headline",group:l,handler:()=>c({editorView:o.editorView,template:"* ",overrideLine:!0})},{command:"code",icon:"code",description:"insert src code block",group:l,handler:()=>c({editorView:o.editorView,template:`#+BEGIN_SRC

#+END_SRC`,focusOffset:12,overrideLine:!0})},{command:"quote",group:l,icon:"format_quote",description:"insert a quote",handler:()=>c({editorView:o.editorView,template:`#+BEGIN_QUOTE

#+END_QUOTE`,focusOffset:14,overrideLine:!0})},{command:"latex",icon:"functions",group:l,description:"insert a latex block",handler:()=>c({editorView:o.editorView,template:`#+BEGIN_EXPORT latex

#+END_EXPORT`,focusOffset:21,overrideLine:!0})},{command:"link",icon:"link",description:"insert a link (url)",group:l,handler:async()=>{const r=await navigator.clipboard.readText(),a=F(r)?r:"",n=`[[${a}][]]`,m=a?a.length+4:2;c({editorView:o.editorView,template:n,focusOffset:m})}},{command:"internal link",icon:"hub",description:"insert note link",group:l,handler:()=>{u.searchWithCustom(r=>{const a=`[[id:${r.id}][${r.meta.title}]]`;c({editorView:o.editorView,template:a,focusOffset:a.length-2})}),e.openCompletion()}},{command:"image",icon:"photo",description:"insert an image",group:l,handler:async()=>{const r=await i.uploadMediaFile();return c({editorView:o.editorView,template:`[[./${r!=null?r:""}]]`,focusOffset:2,overrideLine:!0})}},{command:"bold",icon:"format_bold",description:"insert bold text",group:l,handler:()=>c({editorView:o.editorView,template:"**",focusOffset:1})},{command:"italic",icon:"format_italic",description:"insert italic text",group:l,handler:()=>c({editorView:o.editorView,template:"//",focusOffset:1})},{command:"strikethrough",icon:"format_strikethrough",description:"insert strikethrough text",group:l,handler:()=>c({editorView:o.editorView,template:"++",focusOffset:1})},{command:"inline code",icon:"data_object",description:"insert inline code",group:l,handler:()=>c({editorView:o.editorView,template:"==",focusOffset:1})},{command:"bullet list",icon:"list",description:"insert bullet list",group:l,handler:()=>c({editorView:o.editorView,template:"- "})},{command:"numeric list",icon:"format_list_numbered",description:"insert numeric list",group:l,handler:()=>c({editorView:o.editorView,template:"1. "})},{command:"check list",icon:"checklist",description:"insert check list",group:l,handler:()=>c({editorView:o.editorView,template:"- [ ] "})},{command:"horizontal rule",icon:"horizontal_rule",description:"insert horizontal line",group:l,handler:()=>c({editorView:o.editorView,template:`-----
`})},{command:"html",icon:"html",description:"insert html code block",group:l,handler:()=>c({editorView:o.editorView,template:`#+BEGIN_HTML

#+END_HTML`,focusOffset:13})},{command:"checkbox",icon:"check_box",description:"insert checkbox",group:l,handler:()=>c({editorView:o.editorView,template:"[ ] "})},{command:"table",icon:"grid_on",description:"insert table",group:l,handler:()=>c({editorView:o.editorView,template:`
| `})},{command:"tag",icon:"tag",description:"insert tags",group:l,handler:()=>{let r;const a=o.orgTree.children.find(n=>{var m,p,h,f;if(!n.isNot(I.Keyword))return((p=(m=n.children)==null?void 0:m.first)==null?void 0:p.rawValue.toLowerCase())==="#+title: "&&(r=n),((f=(h=n.children)==null?void 0:h.first)==null?void 0:f.rawValue.toLowerCase())==="#+filetags: "});if(a){o.editorView.dispatch({selection:{anchor:a.end,head:a.end},scrollIntoView:!0});return}if(r){o.editorView.dispatch({changes:{from:r.end,to:r.end,insert:`
#+FILETAGS: ::`},selection:{anchor:r.end+14,head:r.end+14},scrollIntoView:!0});return}}},{command:"datetime",icon:"calendar_today",description:"insert datetime",group:l,handler:()=>{const r=new Date,a=r.toLocaleDateString("default",{weekday:"short"}),n=`<${r.toISOString().split("T")[0]} ${a}> `;c({editorView:o.editorView,template:n})}}];s.register(...d)},J=()=>{const s=T();B(()=>s.activateGroup("editor")),M(()=>s.deactivateGroup("editor"))},_={left:!0,right:!0,up:!0,down:!0,horizontal:!0,vertical:!0},K=Object.keys(_);_.all=!0;function S(s){const i={};for(const o of K)s[o]===!0&&(i[o]=!0);return Object.keys(i).length===0?_:(i.horizontal===!0?i.left=i.right=!0:i.left===!0&&i.right===!0&&(i.horizontal=!0),i.vertical===!0?i.up=i.down=!0:i.up===!0&&i.down===!0&&(i.vertical=!0),i.horizontal===!0&&i.vertical===!0&&(i.all=!0),i)}const j=["INPUT","TEXTAREA"];function L(s,i){return i.event===void 0&&s.target!==void 0&&s.target.draggable!==!0&&typeof i.handler=="function"&&j.includes(s.target.nodeName.toUpperCase())===!1&&(s.qClonedBy===void 0||s.qClonedBy.indexOf(i.uid)===-1)}function C(s,i,o){const u=E(s);let e,t=u.left-i.event.x,d=u.top-i.event.y,r=Math.abs(t),a=Math.abs(d);const n=i.direction;n.horizontal===!0&&n.vertical!==!0?e=t<0?"left":"right":n.horizontal!==!0&&n.vertical===!0?e=d<0?"up":"down":n.up===!0&&d<0?(e="up",r>a&&(n.left===!0&&t<0?e="left":n.right===!0&&t>0&&(e="right"))):n.down===!0&&d>0?(e="down",r>a&&(n.left===!0&&t<0?e="left":n.right===!0&&t>0&&(e="right"))):n.left===!0&&t<0?(e="left",r<a&&(n.up===!0&&d<0?e="up":n.down===!0&&d>0&&(e="down"))):n.right===!0&&t>0&&(e="right",r<a&&(n.up===!0&&d<0?e="up":n.down===!0&&d>0&&(e="down")));let m=!1;if(e===void 0&&o===!1){if(i.event.isFirst===!0||i.event.lastDir===void 0)return{};e=i.event.lastDir,m=!0,e==="left"||e==="right"?(u.left-=t,r=0,t=0):(u.top-=d,a=0,d=0)}return{synthetic:m,payload:{evt:s,touch:i.event.mouse!==!0,mouse:i.event.mouse===!0,position:u,direction:e,isFirst:i.event.isFirst,isFinal:o===!0,duration:Date.now()-i.event.time,distance:{x:r,y:a},offset:{x:t,y:d},delta:{x:u.left-i.event.lastX,y:u.top-i.event.lastY}}}}let H=0;const W=X({name:"touch-pan",beforeMount(s,{value:i,modifiers:o}){if(o.mouse!==!0&&w.has.touch!==!0)return;function u(t,d){o.mouse===!0&&d===!0?$(t):(o.stop===!0&&y(t),o.prevent===!0&&O(t))}const e={uid:"qvtp_"+H++,handler:i,modifiers:o,direction:S(o),noop:U,mouseStart(t){L(t,e)&&G(t)&&(g(e,"temp",[[document,"mousemove","move","notPassiveCapture"],[document,"mouseup","end","passiveCapture"]]),e.start(t,!0))},touchStart(t){if(L(t,e)){const d=t.target;g(e,"temp",[[d,"touchmove","move","notPassiveCapture"],[d,"touchcancel","end","passiveCapture"],[d,"touchend","end","passiveCapture"]]),e.start(t)}},start(t,d){if(w.is.firefox===!0&&b(s,!0),e.lastEvt=t,d===!0||o.stop===!0){if(e.direction.all!==!0&&(d!==!0||e.modifiers.mouseAllDir!==!0&&e.modifiers.mousealldir!==!0)){const n=t.type.indexOf("mouse")!==-1?new MouseEvent(t.type,t):new TouchEvent(t.type,t);t.defaultPrevented===!0&&O(n),t.cancelBubble===!0&&y(n),Object.assign(n,{qKeyEvent:t.qKeyEvent,qClickOutside:t.qClickOutside,qAnchorHandled:t.qAnchorHandled,qClonedBy:t.qClonedBy===void 0?[e.uid]:t.qClonedBy.concat(e.uid)}),e.initialEvent={target:t.target,event:n}}y(t)}const{left:r,top:a}=E(t);e.event={x:r,y:a,time:Date.now(),mouse:d===!0,detected:!1,isFirst:!0,isFinal:!1,lastX:r,lastY:a}},move(t){if(e.event===void 0)return;const d=E(t),r=d.left-e.event.x,a=d.top-e.event.y;if(r===0&&a===0)return;e.lastEvt=t;const n=e.event.mouse===!0,m=()=>{u(t,n);let f;o.preserveCursor!==!0&&o.preservecursor!==!0&&(f=document.documentElement.style.cursor||"",document.documentElement.style.cursor="grabbing"),n===!0&&document.body.classList.add("no-pointer-events--children"),document.body.classList.add("non-selectable"),Y(),e.styleCleanup=v=>{if(e.styleCleanup=void 0,f!==void 0&&(document.documentElement.style.cursor=f),document.body.classList.remove("non-selectable"),n===!0){const k=()=>{document.body.classList.remove("no-pointer-events--children")};v!==void 0?setTimeout(()=>{k(),v()},50):k()}else v!==void 0&&v()}};if(e.event.detected===!0){e.event.isFirst!==!0&&u(t,e.event.mouse);const{payload:f,synthetic:v}=C(t,e,!1);f!==void 0&&(e.handler(f)===!1?e.end(t):(e.styleCleanup===void 0&&e.event.isFirst===!0&&m(),e.event.lastX=f.position.left,e.event.lastY=f.position.top,e.event.lastDir=v===!0?void 0:f.direction,e.event.isFirst=!1));return}if(e.direction.all===!0||n===!0&&(e.modifiers.mouseAllDir===!0||e.modifiers.mousealldir===!0)){m(),e.event.detected=!0,e.move(t);return}const p=Math.abs(r),h=Math.abs(a);p!==h&&(e.direction.horizontal===!0&&p>h||e.direction.vertical===!0&&p<h||e.direction.up===!0&&p<h&&a<0||e.direction.down===!0&&p<h&&a>0||e.direction.left===!0&&p>h&&r<0||e.direction.right===!0&&p>h&&r>0?(e.event.detected=!0,e.move(t)):e.end(t,!0))},end(t,d){if(e.event!==void 0){if(V(e,"temp"),w.is.firefox===!0&&b(s,!1),d===!0)e.styleCleanup!==void 0&&e.styleCleanup(),e.event.detected!==!0&&e.initialEvent!==void 0&&e.initialEvent.target.dispatchEvent(e.initialEvent.event);else if(e.event.detected===!0){e.event.isFirst===!0&&e.handler(C(t===void 0?e.lastEvt:t,e).payload);const{payload:r}=C(t===void 0?e.lastEvt:t,e,!0),a=()=>{e.handler(r)};e.styleCleanup!==void 0?e.styleCleanup(a):a()}e.event=void 0,e.initialEvent=void 0,e.lastEvt=void 0}}};if(s.__qtouchpan=e,o.mouse===!0){const t=o.mouseCapture===!0||o.mousecapture===!0?"Capture":"";g(e,"main",[[s,"mousedown","mouseStart",`passive${t}`]])}w.has.touch===!0&&g(e,"main",[[s,"touchstart","touchStart",`passive${o.capture===!0?"Capture":""}`],[s,"touchmove","noop","notPassiveCapture"]])},updated(s,i){const o=s.__qtouchpan;o!==void 0&&(i.oldValue!==i.value&&(typeof value!="function"&&o.end(),o.handler=i.value),o.direction=S(i.modifiers))},beforeUnmount(s){const i=s.__qtouchpan;i!==void 0&&(i.event!==void 0&&i.end(),V(i,"main"),V(i,"temp"),w.is.firefox===!0&&b(s,!1),i.styleCleanup!==void 0&&i.styleCleanup(),delete s.__qtouchpan)}});export{W as T,S as g,Q as r,L as s,J as u};
