var pe=Object.defineProperty;var ne=Object.getOwnPropertySymbols;var he=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable;var ce=(t,o,s)=>o in t?pe(t,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[o]=s,T=(t,o)=>{for(var s in o||(o={}))he.call(o,s)&&ce(t,s,o[s]);if(ne)for(var s of ne(o))ze.call(o,s)&&ce(t,s,o[s]);return t};import{D as ye,r as q,e as j,w as se,a0 as ge,l as A,W as Me,aS as Ee,X as be,Y as Ae,C as Ve,y as xe}from"./index.e984fdbd.js";import{r as D}from"./rtl.4b414a6d.js";const M=1e3,Re=["start","center","end","start-force","center-force","end-force"],fe=Array.prototype.filter,qe=window.getComputedStyle(document.body).overflowAnchor===void 0?ye:function(t,o){t!==null&&(cancelAnimationFrame(t._qOverflowAnimationFrame),t._qOverflowAnimationFrame=requestAnimationFrame(()=>{if(t===null)return;const s=t.children||[];fe.call(s,y=>y.dataset&&y.dataset.qVsAnchor!==void 0).forEach(y=>{delete y.dataset.qVsAnchor});const f=s[o];f&&f.dataset&&(f.dataset.qVsAnchor="")}))};function F(t,o){return t+o}function Z(t,o,s,f,y,u,V,E){const h=t===window?document.scrollingElement||document.documentElement:t,g=y===!0?"offsetWidth":"offsetHeight",r={scrollStart:0,scrollViewSize:-V-E,scrollMaxSize:0,offsetStart:-V,offsetEnd:-E};if(y===!0?(t===window?(r.scrollStart=window.pageXOffset||window.scrollX||document.body.scrollLeft||0,r.scrollViewSize+=document.documentElement.clientWidth):(r.scrollStart=h.scrollLeft,r.scrollViewSize+=h.clientWidth),r.scrollMaxSize=h.scrollWidth,u===!0&&(r.scrollStart=(D===!0?r.scrollMaxSize-r.scrollViewSize:0)-r.scrollStart)):(t===window?(r.scrollStart=window.pageYOffset||window.scrollY||document.body.scrollTop||0,r.scrollViewSize+=document.documentElement.clientHeight):(r.scrollStart=h.scrollTop,r.scrollViewSize+=h.clientHeight),r.scrollMaxSize=h.scrollHeight),s!==null)for(let v=s.previousElementSibling;v!==null;v=v.previousElementSibling)v.classList.contains("q-virtual-scroll--skip")===!1&&(r.offsetStart+=v[g]);if(f!==null)for(let v=f.nextElementSibling;v!==null;v=v.nextElementSibling)v.classList.contains("q-virtual-scroll--skip")===!1&&(r.offsetEnd+=v[g]);if(o!==t){const v=h.getBoundingClientRect(),w=o.getBoundingClientRect();y===!0?(r.offsetStart+=w.left-v.left,r.offsetEnd-=w.width):(r.offsetStart+=w.top-v.top,r.offsetEnd-=w.height),t!==window&&(r.offsetStart+=r.scrollStart),r.offsetEnd+=r.scrollMaxSize-r.offsetStart}return r}function ue(t,o,s,f){o==="end"&&(o=(t===window?document.body:t)[s===!0?"scrollWidth":"scrollHeight"]),t===window?s===!0?(f===!0&&(o=(D===!0?document.body.scrollWidth-document.documentElement.clientWidth:0)-o),window.scrollTo(o,window.pageYOffset||window.scrollY||document.body.scrollTop||0)):window.scrollTo(window.pageXOffset||window.scrollX||document.body.scrollLeft||0,o):s===!0?(f===!0&&(o=(D===!0?t.scrollWidth-t.offsetWidth:0)-o),t.scrollLeft=o):t.scrollTop=o}function C(t,o,s,f){if(s>=f)return 0;const y=o.length,u=Math.floor(s/M),V=Math.floor((f-1)/M)+1;let E=t.slice(u,V).reduce(F,0);return s%M!==0&&(E-=o.slice(u*M,s).reduce(F,0)),f%M!==0&&f!==y&&(E-=o.slice(f,V*M).reduce(F,0)),E}const ke={virtualScrollSliceSize:{type:[Number,String],default:null},virtualScrollSliceRatioBefore:{type:[Number,String],default:1},virtualScrollSliceRatioAfter:{type:[Number,String],default:1},virtualScrollItemSize:{type:[Number,String],default:24},virtualScrollStickySizeStart:{type:[Number,String],default:0},virtualScrollStickySizeEnd:{type:[Number,String],default:0},tableColspan:[Number,String]},Fe=T({virtualScrollHorizontal:Boolean,onVirtualScroll:Function},ke);function Oe({virtualScrollLength:t,getVirtualScrollTarget:o,getVirtualScrollEl:s,virtualScrollItemSizeComputed:f}){const y=xe(),{props:u,emit:V,proxy:E}=y,{$q:h}=E;let g,r,v,w=[],d;const x=q(0),k=q(0),O=q({}),_=q(null),W=q(null),H=q(null),m=q({from:0,to:0}),I=j(()=>u.tableColspan!==void 0?u.tableColspan:100);f===void 0&&(f=j(()=>u.virtualScrollItemSize));const ee=j(()=>f.value+";"+u.virtualScrollHorizontal),de=j(()=>ee.value+";"+u.virtualScrollSliceRatioBefore+";"+u.virtualScrollSliceRatioAfter);se(de,()=>{B()}),se(ee,L);function L(){G(r,!0)}function le(e){G(e===void 0?r:e)}function N(e,l){const i=o();if(i==null||i.nodeType===8)return;const S=Z(i,s(),_.value,W.value,u.virtualScrollHorizontal,h.lang.rtl,u.virtualScrollStickySizeStart,u.virtualScrollStickySizeEnd);v!==S.scrollViewSize&&B(S.scrollViewSize),P(i,S,Math.min(t.value-1,Math.max(0,parseInt(e,10)||0)),0,Re.indexOf(l)>-1?l:r>-1&&e>r?"end":"start")}function Se(){const e=o();if(e==null||e.nodeType===8)return;const l=Z(e,s(),_.value,W.value,u.virtualScrollHorizontal,h.lang.rtl,u.virtualScrollStickySizeStart,u.virtualScrollStickySizeEnd),i=t.value-1,S=l.scrollMaxSize-l.offsetStart-l.offsetEnd-k.value;if(g===l.scrollStart)return;if(l.scrollMaxSize<=0){P(e,l,0,0);return}v!==l.scrollViewSize&&B(l.scrollViewSize),U(m.value.from);const p=Math.floor(l.scrollMaxSize-Math.max(l.scrollViewSize,l.offsetEnd)-Math.min(d[i],l.scrollViewSize/2));if(p>0&&Math.ceil(l.scrollStart)>=p){P(e,l,i,l.scrollMaxSize-l.offsetEnd-w.reduce(F,0));return}let c=0,n=l.scrollStart-l.offsetStart,z=n;if(n<=S&&n+l.scrollViewSize>=x.value)n-=x.value,c=m.value.from,z=n;else for(let a=0;n>=w[a]&&c<i;a++)n-=w[a],c+=M;for(;n>0&&c<i;)n-=d[c],n>-l.scrollViewSize?(c++,z=n):z=d[c]+n;P(e,l,c,z)}function P(e,l,i,S,p){const c=typeof p=="string"&&p.indexOf("-force")>-1,n=c===!0?p.replace("-force",""):p,z=n!==void 0?n:"start";let a=Math.max(0,i-O.value[z]),b=a+O.value.total;b>t.value&&(b=t.value,a=Math.max(0,b-O.value.total)),g=l.scrollStart;const X=a!==m.value.from||b!==m.value.to;if(X===!1&&n===void 0){oe(i);return}const{activeElement:ie}=document,R=H.value;X===!0&&R!==null&&R!==ie&&R.contains(ie)===!0&&(R.addEventListener("focusout",te),setTimeout(()=>{R!==null&&R.removeEventListener("focusout",te)})),qe(R,i-a);const me=n!==void 0?d.slice(a,i).reduce(F,0):0;if(X===!0){const Y=b>=m.value.from&&a<=m.value.to?m.value.to:b;m.value={from:a,to:Y},x.value=C(w,d,0,a),k.value=C(w,d,b,t.value),requestAnimationFrame(()=>{m.value.to!==b&&g===l.scrollStart&&(m.value={from:m.value.from,to:b},k.value=C(w,d,b,t.value))})}requestAnimationFrame(()=>{if(g!==l.scrollStart)return;X===!0&&U(a);const Y=d.slice(a,i).reduce(F,0),$=Y+l.offsetStart+x.value,ae=$+d[i];let K=$+S;if(n!==void 0){const we=Y-me,Q=l.scrollStart+we;K=c!==!0&&Q<$&&ae<Q+l.scrollViewSize?Q:n==="end"?ae-l.scrollViewSize:$-(n==="start"?0:Math.round((l.scrollViewSize-d[i])/2))}g=K,ue(e,K,u.virtualScrollHorizontal,h.lang.rtl),oe(i)})}function U(e){const l=H.value;if(l){const i=fe.call(l.children,a=>a.classList&&a.classList.contains("q-virtual-scroll--skip")===!1),S=i.length,p=u.virtualScrollHorizontal===!0?a=>a.getBoundingClientRect().width:a=>a.offsetHeight;let c=e,n,z;for(let a=0;a<S;){for(n=p(i[a]),a++;a<S&&i[a].classList.contains("q-virtual-scroll--with-prev")===!0;)n+=p(i[a]),a++;z=n-d[c],z!==0&&(d[c]+=z,w[Math.floor(c/M)]+=z),c++}}}function te(){H.value!==null&&H.value!==void 0&&H.value.focus()}function G(e,l){const i=1*f.value;(l===!0||Array.isArray(d)===!1)&&(d=[]);const S=d.length;d.length=t.value;for(let c=t.value-1;c>=S;c--)d[c]=i;const p=Math.floor((t.value-1)/M);w=[];for(let c=0;c<=p;c++){let n=0;const z=Math.min((c+1)*M,t.value);for(let a=c*M;a<z;a++)n+=d[a];w.push(n)}r=-1,g=void 0,x.value=C(w,d,0,m.value.from),k.value=C(w,d,m.value.to,t.value),e>=0?(U(m.value.from),ge(()=>{N(e)})):J()}function B(e){if(e===void 0&&typeof window!="undefined"){const n=o();n!=null&&n.nodeType!==8&&(e=Z(n,s(),_.value,W.value,u.virtualScrollHorizontal,h.lang.rtl,u.virtualScrollStickySizeStart,u.virtualScrollStickySizeEnd).scrollViewSize)}v=e;const l=parseFloat(u.virtualScrollSliceRatioBefore)||0,i=parseFloat(u.virtualScrollSliceRatioAfter)||0,S=1+l+i,p=e===void 0||e<=0?1:Math.ceil(e/f.value),c=Math.max(1,p,Math.ceil((u.virtualScrollSliceSize>0?u.virtualScrollSliceSize:10)/S));O.value={total:Math.ceil(c*S),start:Math.ceil(c*l),center:Math.ceil(c*(.5+l)),end:Math.ceil(c*(1+l)),view:p}}function ve(e,l){const i=u.virtualScrollHorizontal===!0?"width":"height",S={["--q-virtual-scroll-item-"+i]:f.value+"px"};return[e==="tbody"?A(e,{class:"q-virtual-scroll__padding",key:"before",ref:_},[A("tr",[A("td",{style:T({[i]:`${x.value}px`},S),colspan:I.value})])]):A(e,{class:"q-virtual-scroll__padding",key:"before",ref:_,style:T({[i]:`${x.value}px`},S)}),A(e,{class:"q-virtual-scroll__content",key:"content",ref:H,tabindex:-1},l.flat()),e==="tbody"?A(e,{class:"q-virtual-scroll__padding",key:"after",ref:W},[A("tr",[A("td",{style:T({[i]:`${k.value}px`},S),colspan:I.value})])]):A(e,{class:"q-virtual-scroll__padding",key:"after",ref:W,style:T({[i]:`${k.value}px`},S)})]}function oe(e){r!==e&&(u.onVirtualScroll!==void 0&&V("virtual-scroll",{index:e,from:m.value.from,to:m.value.to-1,direction:e<r?"decrease":"increase",ref:E}),r=e)}B();const J=Me(Se,h.platform.is.ios===!0?120:35);Ee(()=>{B()});let re=!1;return be(()=>{re=!0}),Ae(()=>{if(re!==!0)return;const e=o();g!==void 0&&e!==void 0&&e!==null&&e.nodeType!==8?ue(e,g,u.virtualScrollHorizontal,h.lang.rtl):N(r)}),Ve(()=>{J.cancel()}),Object.assign(E,{scrollTo:N,reset:L,refresh:le}),{virtualScrollSliceRange:m,virtualScrollSliceSizeComputed:O,setVirtualScrollSize:B,onVirtualScrollEvt:J,localResetVirtualScroll:G,padVirtualScroll:ve,scrollTo:N,reset:L,refresh:le}}export{Oe as a,Fe as u};
