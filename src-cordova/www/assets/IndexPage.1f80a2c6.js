var ae=Object.defineProperty,le=Object.defineProperties;var se=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var re=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable;var j=(e,a,t)=>a in e?ae(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t,x=(e,a)=>{for(var t in a||(a={}))re.call(a,t)&&j(e,t,a[t]);if(O)for(var t of O(a))oe.call(a,t)&&j(e,t,a[t]);return e},N=(e,a)=>le(e,se(a));import{b as H,_ as ie,d as ne,a as ce,c as ue,e as de}from"./FilePath.2a16f69c.js";import{q as z,e as n,l as w,x as I,y as G,r as V,w as A,A as me,E as K,aS as ve,B as J,Y as fe,X as pe,C as _e,L as be,bg as he,bh as ge,k as B,t as X,aV as R,aa as L,u as qe,o as p,a3 as P,a4 as m,a5 as y,h as r,af as k,a7 as E,a8 as $,ae as F,f as C,ab as U,aK as Se,aH as W,a9 as ye,be as we,b8 as xe,a6 as ke}from"./index.a68bc811.js";import{Q as Ne}from"./QList.8cfe3307.js";import{u as Z,a as ee}from"./use-dark.4e3578ff.js";import{u as Pe,a as Ve}from"./use-virtual-scroll.a4f5649c.js";import{u as te,Q as Ce}from"./view.981d485d.js";import{_ as Be}from"./AuthorInfo.844834bf.js";import{_ as ze}from"./ModeLine.5ee4f96a.js";import"./use-checkbox.704e7718.js";import"./use-form.cb89fda3.js";import"./QMenu.2fa72b7a.js";import"./focus-manager.387b0375.js";import"./use-tick.65c3baf2.js";import"./use-timeout.ef68d622.js";import"./QItemSection.312d24df.js";import"./rtl.4b414a6d.js";import"./QFooter.da2957db.js";const Qe=["horizontal","vertical","cell","none"];var Te=z({name:"QMarkupTable",props:N(x({},Z),{dense:Boolean,flat:Boolean,bordered:Boolean,square:Boolean,wrapCells:Boolean,separator:{type:String,default:"horizontal",validator:e=>Qe.includes(e)}}),setup(e,{slots:a}){const t=G(),l=ee(e,t.proxy.$q),s=n(()=>`q-markup-table q-table__container q-table__card q-table--${e.separator}-separator`+(l.value===!0?" q-table--dark q-table__card--dark q-dark":"")+(e.dense===!0?" q-table--dense":"")+(e.flat===!0?" q-table--flat":"")+(e.bordered===!0?" q-table--bordered":"")+(e.square===!0?" q-table--square":"")+(e.wrapCells===!1?" q-table--no-wrap":""));return()=>w("div",{class:s.value},[w("table",{class:"q-table"},I(a.default))])}});function $e(e,a){return w("div",e,[w("table",{class:"q-table"},a)])}const Ae={list:Ne,table:Te},Ie=["list","table","__qtable"];var Re=z({name:"QVirtualScroll",props:N(x({},Pe),{type:{type:String,default:"list",validator:e=>Ie.includes(e)},items:{type:Array,default:()=>[]},itemsFn:Function,itemsSize:Number,scrollTarget:{default:void 0}}),setup(e,{slots:a,attrs:t}){let l;const s=V(null),i=n(()=>e.itemsSize>=0&&e.itemsFn!==void 0?parseInt(e.itemsSize,10):Array.isArray(e.items)?e.items.length:0),{virtualScrollSliceRange:o,localResetVirtualScroll:g,padVirtualScroll:_,onVirtualScrollEvt:q}=Ve({virtualScrollLength:i,getVirtualScrollTarget:v,getVirtualScrollEl:u}),S=n(()=>{if(i.value===0)return[];const h=(T,M)=>({index:o.value.from+M,item:T});return e.itemsFn===void 0?e.items.slice(o.value.from,o.value.to).map(h):e.itemsFn(o.value.from,o.value.to-o.value.from).map(h)}),c=n(()=>"q-virtual-scroll q-virtual-scroll"+(e.virtualScrollHorizontal===!0?"--horizontal":"--vertical")+(e.scrollTarget!==void 0?"":" scroll")),b=n(()=>e.scrollTarget!==void 0?{}:{tabindex:0});A(i,()=>{g()}),A(()=>e.scrollTarget,()=>{f(),d()});function u(){return s.value.$el||s.value}function v(){return l}function d(){l=me(u(),e.scrollTarget),l.addEventListener("scroll",q,K.passive)}function f(){l!==void 0&&(l.removeEventListener("scroll",q,K.passive),l=void 0)}function Q(){let h=_(e.type==="list"?"div":"tbody",S.value.map(a.default));return a.before!==void 0&&(h=a.before().concat(h)),be(a.after,h)}return ve(()=>{g()}),J(()=>{d()}),fe(()=>{d()}),pe(()=>{f()}),_e(()=>{f()}),()=>{if(a.default===void 0){console.error("QVirtualScroll: default scoped slot is required for rendering");return}return e.type==="__qtable"?$e({ref:s,class:"q-table__middle "+c.value},Q()):w(Ae[e.type],x(N(x({},t),{ref:s,class:[t.class,c.value]}),b.value),Q)}}}),D=z({name:"QCardSection",props:{tag:{type:String,default:"div"},horizontal:Boolean},setup(e,{slots:a}){const t=n(()=>`q-card__section q-card__section--${e.horizontal===!0?"horiz row no-wrap":"vert"}`);return()=>w(e.tag,{class:t.value},I(a.default))}}),Me=z({name:"QCardActions",props:N(x({},he),{vertical:Boolean}),setup(e,{slots:a}){const t=ge(e),l=n(()=>`q-card__actions ${t.value} q-card__actions--${e.vertical===!0?"vert column":"horiz row"}`);return()=>w("div",{class:l.value},I(a.default))}}),Fe=z({name:"QCard",props:N(x({},Z),{tag:{type:String,default:"div"},square:Boolean,flat:Boolean,bordered:Boolean}),setup(e,{slots:a}){const t=G(),l=ee(e,t.proxy.$q),s=n(()=>"q-card"+(l.value===!0?" q-card--dark q-dark":"")+(e.bordered===!0?" q-card--bordered":"")+(e.square===!0?" q-card--square no-border-radius":"")+(e.flat===!0?" q-card--flat no-shadow":""));return()=>w(e.tag,{class:s.value},I(a.default))}});const De={key:0,class:"q-px-sm"},Ee=["src"],Le={class:"text-overline q-px-sm"},Ue={class:"text-h4 text-weight-bold pointer q-px-sm"},Oe={class:"text-caption rft q-px-sm description"},je={key:1,class:"mock-picture pointer rounded-borders"},Y=B({__name:"PublicNotePreview",props:{note:{},showAuthor:{type:Boolean},selectable:{type:Boolean}},setup(e){var b;const a=e,{note:t,selectable:l}=X(a),s=R(),i=L(),o=u=>{s.selectNote(u),i.push({name:U.NoteDetail,params:{id:u.id}})},g=te(),_=n(()=>g.tile),q=qe(),{showUserProfiles:S}=X(q),c=V((b=t.value.meta.images)==null?void 0:b[0]);return A(()=>t.value.meta.images,u=>{c.value=u==null?void 0:u[0]}),(u,v)=>(p(),P("article",null,[m(Fe,{flat:"",class:"q-mt-lg"},{default:y(()=>[r(S)&&u.showAuthor?(p(),P("div",De,[m(Be,{author:r(t).author},null,8,["author"])])):k("",!0),m(D,{horizontal:"",class:E([{"note-card-content":_.value,column:_.value},"note-card-content pointer"]),onClick:v[0]||(v[0]=d=>o(r(t)))},{default:y(()=>[_.value&&c.value?(p(),P("img",{key:0,class:"preview-image rounded-borders",src:r(H)(c.value)},null,8,Ee)):k("",!0),m(D,{class:"fit q-pa-none q-pt-sm"},{default:y(()=>{var d,f;return[$("div",Le,F(r(t).meta.category),1),$("div",Ue,F(r(t).meta.title),1),r(t).filePath?(p(),C(ie,{key:0,filePath:r(t).filePath,class:"q-py-xs q-px-sm"},null,8,["filePath"])):k("",!0),$("div",Oe,F(r(t).meta.description),1),m(ne,{class:"q-mt-md q-pa-sm",tags:(f=(d=r(t))==null?void 0:d.meta)==null?void 0:f.fileTags},null,8,["tags"])]}),_:1}),!_.value&&c.value?(p(),C(D,{key:1,class:"flex col-3 flex-start q-pa-none q-pt-sm justify-end"},{default:y(()=>[c.value?(p(),C(ce,{key:0,class:"pointer rounded-borders image-preview",src:r(H)(c.value)},null,8,["src"])):(p(),P("div",je))]),_:1})):k("",!0)]),_:1},8,["class"]),m(Me,{class:"q-px-none justify-between q-my-md actions"},{default:y(()=>[m(ue,{class:"q-px-sm",note:r(t),selectable:r(l)},null,8,["note","selectable"])]),_:1}),m(Ce)]),_:1})]))}}),He=B({__name:"AsyncPublicNoteContainer",props:{index:{},offset:{}},setup(e){const a=e,t=R(),l=n(()=>{const{index:s}=a;return t.notes[s]});return(s,i)=>l.value?Se(s.$slots,"default",{key:0,note:l.value}):k("",!0)}});const Ke=B({__name:"PublicNotes",setup(e){B({PublicNotePreview:Y});const a=te(),t=n(()=>a.tile),l=L(),s=n(()=>l.currentRoute.value.name===U.UserNotes),i=V(null),o=R(),g=v=>Math.ceil(v/o.filters.limit)*o.filters.limit,_=V(!1),q=v=>{_.value=!0;const d=g(v);return o.fetchNotes(d),l.push({query:{limit:o.filters.limit,offset:d}}),Object.freeze(new Array(o.filters.limit).fill(null))},c=W().query.offset;J(()=>{!c||i.value.scrollTo(c)});const b=V([]),u=(v,d)=>{if(!!s.value){if(d){b.value=[...b.value,v];return}b.value=b.value.filter(f=>f.id!==v.id)}};return(v,d)=>{var f;return p(),P("div",{class:E(["q-pa-lg items-start public-notes",{row:t.value,column:!t.value}])},[m(Re,{ref_key:"virtualScrollRef",ref:i,"items-size":r(o).notesCount,"virtual-scroll-slice-size":((f=r(o).filters)==null?void 0:f.limit)||10,"virtual-scroll-item-size":205,"virtual-scroll-slice-ratio-before":1,"virtual-scroll-slice-ratio-after":1,"items-fn":q,"scroll-target":"body",class:"full-width",style:{"max-height":"cacl(100vh - 66px)"}},{default:y(({index:Q})=>{var h;return[m(He,{index:Q,offset:(h=r(o).filters)==null?void 0:h.offset},{default:y(({note:T})=>[$("div",{class:E({fit:!t.value,"col-4":t.value})},[m(Y,{note:T,"show-author":!s.value,selectable:s.value,onSelected:M=>u(T,M)},null,8,["note","show-author","selectable","onSelected"])],2)]),_:2},1032,["index","offset"])]}),_:1},8,["items-size","virtual-scroll-slice-size"])],2)}}});var Xe=ye(Ke,[["__scopeId","data-v-378db6ba"]]);const Ye={class:"container content"},ft=B({__name:"IndexPage",setup(e){const a=R(),t=W(),l=()=>{a.setFilters({searchText:t.query.search,userId:t.params.userId,limit:+t.query.limit,offset:+t.query.offset})},s=()=>{l(),a.loadNotes()};s(),A(()=>t.params.userId,()=>{var S;((S=a.filters)==null?void 0:S.userId)!=t.params.userId&&s()});const i=we(),o=()=>{a.deleteNotes(i.selectedNotesIds),i.clearSelectedNotes()},g=n(()=>a.notes.length),_=L(),q=n(()=>_.currentRoute.value.name===U.UserNotes);return(S,c)=>(p(),P("div",Ye,[m(Xe,{ref:"publicNotesRef",notes:r(a).notes},null,8,["notes"]),g.value?(p(),C(ze,{key:0,tabMode:!1},xe({_:2},[q.value?{name:"left",fn:y(()=>[m(de,{class:"q-pl-sm",modelValue:r(i).isAllNotesSelected,size:"sm","onUpdate:modelValue":r(i).toggleBulkNotesSelection},null,8,["modelValue","onUpdate:modelValue"]),r(i).isSomeNotesSelected?(p(),C(ke,{key:0,square:"",class:"themed-button",icon:"delete",flat:"",onClick:o})):k("",!0)]),key:"0"}:void 0]),1024)):k("",!0)]))}});export{ft as default};
